{{ define "main" }}
<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll(".speaker-avatar").forEach(btn => {
            btn.addEventListener("click", () => {
                const id = "modal-" + btn.dataset.speaker;
                document.getElementById(id).classList.remove("hidden");
            });
        });

        document.querySelectorAll(".close-modal").forEach(btn => {
            btn.addEventListener("click", () => {
                btn.closest(".speaker-modal").classList.add("hidden");
            });
        });
    });
</script>
<section class="schedule-grid">
    {{ $events := (where (site.GetPage "section" "scheduled-event").RegularPages "Draft" false) }}
    {{ $byDay := dict }}
    {{ range $events }}
    {{ $day := .Params.day | default "ALTRO" }}
    {{ $list := (index $byDay $day | default (slice)) | append . }}
    {{ $byDay = merge $byDay (dict $day $list) }}
    {{ end }}

    {{ range $day := slice "monday" "tuesday" "wednesday" "thursday" "friday" "saturday" "sunday" }}
    {{ with index $byDay $day }}
    <div class="day-column">
        <h2>{{ $day }}</h2>
        {{ range sort . "Params.weight" }}
        <div class="round-table-card">
            <div class="card-content">

                {{ with .Params.coverImage }}
                <img class="card-image-container" src="{{ . | relURL }}" alt="{{ $.Params.title }}">
                {{ end }}

                <h3>{{ .Params.name }}</h3>
                <a href="https://www.google.com/maps/search/?api=1&query={{ .Params.address | urlize }}" target="_blank" rel="noopener noreferrer" class="card-location">
                    <i class="fa-solid fa-location-dot"></i>
                    <span>{{ .Params.address }}</span>
                </a>

                {{ with .Params.speakers }}
                <div class="speakers-list">
                    <i class="fa-solid fa-microphone mic"></i>
                    {{ range . }}
                    {{ $speaker := site.GetPage (printf "/guests/%s" .) }}
                    {{ with $speaker }}
                    <button class="speaker-avatar" data-speaker="{{ .File.BaseFileName }}">
                        <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}">
                    </button>

                    <div id="modal-{{ .File.BaseFileName }}" class="speaker-modal hidden">
                        <div class="modal-content">
                            <img src="{{ .Params.image | relURL }}" alt="{{ .Title }}">
                            <h3>{{ .Title }}</h3>
                            <p><strong>{{ .Params.role }}</strong></p>
                            <div class="bio">{{ .Params.bio | markdownify }}</div>
                            <button class="close-modal">
                                <i class="fa-solid fa-circle-xmark"></i>
                            </button>
                        </div>
                    </div>
                    {{ end }}
                    {{ end }}
                </div>
                {{ end }}

            </div>
        </div>
        {{ end }}
    </div>
    {{ end }}
    {{ end }}
</section>

{{ end }}