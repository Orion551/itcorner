{{ define "main" }}
<div class="page-content schedule-grid">

    <!-- Introduction -->
    <section class="schedule-intro">
        {{ .Content }}
    </section>

    <!-- Filters -->
    <div class="filters-container">
        {{ $contextPages := site.GetPage "section" "contexts" }}
        {{ range $contextPages.RegularPages }}
        <button class="filter-button" data-filter="{{ .Params.name | urlize }}">
            {{ .Params.label }}
        </button>
        {{ end }}
    </div>

    <!-- DAys -->
    {{ $events := (where (site.GetPage "section" "scheduled-event").RegularPages "Draft" false) }}
    {{ $byDay := dict }}
    {{ range $events }}
    {{ $day := .Params.day | default "ALTRO" }}
    {{ $list := (index $byDay $day | default (slice)) | append . }}
    {{ $byDay = merge $byDay (dict $day $list) }}
    {{ end }}

    <div class="days-scroll">
        {{ range $day := slice "monday" "tuesday" "wednesday" "thursday" "friday" "saturday" "sunday" }}
        {{ with index $byDay $day }}
        <div class="day-column">
            <div class="day-title-container">
                <h2 class="day-title">{{ $day }}</h2>
            </div>

            {{ range sort . "Params.weight" }}
            {{ partial "event-card.html" . }}
            {{ end }}
        </div>
        {{ end }}
        {{ end }}
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const filterButtons = document.querySelectorAll(".filter-button");
        const eventCards = document.querySelectorAll(".scheduled-event-card");
        const dayColumns = document.querySelectorAll(".day-column");

        filterButtons.forEach(button => {
            button.addEventListener("click", () => {
                const filter = button.dataset.filter;

                // Removes 'active' class from all buttons and adds it to the one the user clicked
                filterButtons.forEach(btn => btn.classList.remove("active"));
                button.classList.add("active");

                // Show/Hide cards and columns based on filter
                eventCards.forEach(card => {
                    const cardContext = card.dataset.context;
                    if (filter === "all" || cardContext === filter) {
                        card.style.display = "block";
                    } else {
                        card.style.display = "none";
                    }
                });

                dayColumns.forEach(column => {
                    const visibleCards = column.querySelectorAll(".scheduled-event-card[style='display: block;']").length;
                    if (visibleCards > 0) {
                        column.style.display = "block";
                    } else {
                        column.style.display = "none";
                    }
                });
            });
        });
    });
</script>

{{ end }}